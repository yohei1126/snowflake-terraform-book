---
title: "Snowflake のリソース構成管理に Terraform を導入するメリットとデメリット"
---

# 公式のリソース作成方法

皆さんは、Snowflake 上でデータベース、スキーマ、テーブル、ロールなどを作成する際にどういう手順を取っているでしょうか？公式に提供されている手段としては以下があります。

* (1) Web 画面を操作する
* (2) Web コンソールで SQL クエリを実行する
* (3) CLI で SQL クエリを実行する

これらのうち、(3) のみ以下の理由で自動化やチームでの構成管理と相性が良く、ソフトウェアエンジニアとしては管理しやすく、小規模なチーム開発には導入しやすいと言えるでしょう。

* コードとして記述されるので、現状の構成が分かりやすい。
* シェルや環境変数などと組み合わせると、同じコードを流用しつつ、異なる環境に対応できる。

一方で、以下のような理由により、スマートなやり方ではないので、開発に参加する人数が増えた場合に混乱をきたす可能性があります。

* 状態ロックの仕組みがないので、CIや複数人での作業が競合した場合、意図していない結果になる可能性がある。
* CLI や SQL そのものが複数環境をサポートするものではないので、自作のシェルスクリプトが読みづらくなる。

そこで、上記に挙げた問題を一通り解決する手法として、私のチームでは、Terraform の Snowflake プラグインを導入しました。

* コードによるリソース記述
* 複数人による作業競合を防ぐ状態ロックの仕組み
* 同じコードを流用した複数環境へのデプロイ
* 実際に変更をデプロイする前の差分確認

なお、調査した範囲では、サードパーティのツールで構成管理に利用できるものは他になく、筆者は以前の職場で AWS・GCP などパブリッククラウドの構成管理に Terraform を用いていたので、Terraform を導入することを決意しました。

# Terraform を導入する際の注意事項

今回紹介した Terraform プラグインは、あくまでもサードパーティのツールが OSS として開発されている点を理解する必要があります。

Snowflake 社の公式ツールではないため、Snowflake 社が公式に品質保証をしてるわけではありません。一部機能が Snowlake の機能と適応しておらず、意図しない動作をする場合があります。また、プラグインが最新機能に適用していない場合があります。そういう状況を理解した上で、自分のプロジェクトに合う場合に自己責任で利用するのが OSS の流儀です。

OSS のツールですので、もし意図していない振る舞いを見つけた場合、欲しい機能に対応していない場合は、[Github リポジトリ](https://github.com/chanzuckerberg/terraform-provider-snowflake)でコミュニティに対応状況や今後の予定を質問してみたり、自分で Pull Request を送ったりしましょう。

Terraform プラグインは、言語仕様がシンプルな Go 言語で実装されており、プラグイン自身も構造がシンプルなため、コードを理解するのも簡単ですし、OSS の中では比較的に貢献しやすいプロジェクトと言えます。
